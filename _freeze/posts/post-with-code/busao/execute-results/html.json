{
  "hash": "e97cbae801ed81cc5788b691357fcc65",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Mapa Interativo de √înibus em Tempo Real ‚Äì Usando a API Olho Vivo\"\nauthor: \"Nat√£ Henrique\"\ndate: \"2025-11-23\"\ncategories: [api, python, maps]\nimage: \"busao.jpg\"\nupyter: python3\nresources:\n  - mapa_onibus.html\n---\n\n## Introdu√ß√£o\nNeste post mostro como constru√≠ um mapa interativo usando Python, Folium e a API p√∫blica Olho Vivo da SPTrans. \n\n---\n\n## Autentica√ß√£o na API e busca da linha\n\n::: {#e320ef3c .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nimport webbrowser\nimport os\n\nTOKEN = \"b07b39ca6bcf06d0e3b9f3e54c99fd54e03ebcde54736c1badfea0daf3f92805\"\nBASE_URL = \"http://api.olhovivo.sptrans.com.br/v2.1\"\n\nsession = requests.Session()\nauth = session.post(f\"{BASE_URL}/Login/Autenticar?token={TOKEN}\")\n\nif auth.json() != True:\n    print(\"Falha na autentica√ß√£o!\")\n    raise SystemExit()\n\nprint(\"Autenticado com sucesso!\")\n\nlinha_digitada = \"697\"\nresp_linhas = session.get(f\"{BASE_URL}/Linha/Buscar?termosBusca={linha_digitada}\")\nlinhas = resp_linhas.json()\n\nif not linhas:\n    print(\"Linha n√£o encontrada!\")\n    raise SystemExit()\n\nlinha = linhas[0]\ncodigo_linha = linha['cl']\nlinha\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAutenticado com sucesso!\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\n{'cl': 1505,\n 'lc': False,\n 'lt': '6970',\n 'sl': 1,\n 'tl': 10,\n 'tp': 'TERM. STO. AMARO',\n 'ts': 'TERM. GRAJA√ö'}\n```\n:::\n:::\n\n\nAqui realizo o login na API, procuro a linha informada e obtenho o c√≥digo interno da linha, necess√°rio para consultar paradas e ve√≠culos.\n\nüîπ Buscando paradas e gerando o mapa base\n\n::: {#620e5376 .cell execution_count=2}\n``` {.python .cell-code}\nresp_paradas = session.get(f\"{BASE_URL}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\")\nparadas = resp_paradas.json()\n\nif not paradas:\n    print(\"Nenhuma parada encontrada!\")\n    raise SystemExit()\n\nlat_centro = paradas[0][\"py\"]\nlon_centro = paradas[0][\"px\"]\n\nmapa = folium.Map(location=[lat_centro, lon_centro], zoom_start=14)\n\nfor p in paradas:\n    folium.Marker(\n        location=[p[\"py\"], p[\"px\"]],\n        popup=p[\"np\"],\n        icon=folium.Icon(color=\"blue\", icon=\"bus\")\n    ).add_to(mapa)\n\nlen(paradas)\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\n15\n```\n:::\n:::\n\n\nAqui consulto todas as paradas da linha e marco cada uma no mapa usando Folium.\n\nüîπ Obtendo a posi√ß√£o dos √¥nibus e finalizando o mapa\n\n::: {#bd55ec70 .cell execution_count=3}\n``` {.python .cell-code}\nresp_posicao = session.get(f\"{BASE_URL}/Posicao/Linha?codigoLinha={codigo_linha}\")\ndados = resp_posicao.json()\n\nonibus = dados.get(\"vs\", [])\n\nfor bus in onibus:\n    folium.Marker(\n        location=[bus[\"py\"], bus[\"px\"]],\n        popup=f\"Prefixo: {bus.get('p')} ‚Äì Velocidade: {bus.get('v')} km/h\",\n        icon=folium.Icon(color=\"red\", icon=\"info-sign\")\n    ).add_to(mapa)\n    mapa.save(\"mapa_onibus.html\")\n\n```\n:::\n\n\nAqui marco cada √¥nibus ativo no mapa.\n\nConclus√£o\nCom poucos blocos de c√≥digo conseguimos autenticar, consultar linha, paradas, posi√ß√£o dos ve√≠culos e exibir tudo em um mapa interativo.\n\n## Mapa Final\n\n<iframe \n    src=\"mapa_onibus.html\"\n    width=\"100%\" \n    height=\"600px\" \n    style=\"border:none;\"\n></iframe>\n\n",
    "supporting": [
      "busao_files"
    ],
    "filters": [],
    "includes": {}
  }
}